plugins{
    alias qLibs.plugins.quarkus
    alias qLibs.plugins.jandex
}
dependencies {
    implementation project(":core:shared:utils")
    implementation project(":core:shared:schema:music:json")
    implementation project(":core:shared:jooq")
}
apply from: "$rootDir/gradle/library/quarkus.gradle"
apply from: "$rootDir/gradle/library/sqldb.gradle"

apply from: "./jooq.gradle"
sourceSets {
    main {
        java {
            srcDirs = [
                'src/main/java',
                'src/gen/java'
            ]
        }
    }
}
task startMysql {
    description = 'Database related tasks.'
    group = 'Database'
    doFirst {
        File workingDir = new File("$projectDir/database")
        String command = "docker-compose up -d"
        def proc = command.execute(null, workingDir)
        proc.waitFor()
    }
    doLast {
        exec {
            commandLine("$rootDir/scripts/waitFor.sh")
            args = [
                "-h",
                "localhost",
                "-p",
                "3306"
            ]
        }
    }
}

tasks.test.dependsOn(startMysql)
